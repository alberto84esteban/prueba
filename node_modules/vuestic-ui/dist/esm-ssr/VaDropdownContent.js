import{__decorate as e}from"tslib";import{nextTick as t,watch as o,mergeProps as n,defineComponent as r}from"vue";import{V as s,m as i,O as a,p as d}from"./vue-class-component.esm-bundler.js";import{DebounceLoader as h}from"asva-executors";import{createPopper as p}from"@popperjs/core";import{S as c}from"./StatefulMixin.js";import{ssrRenderAttrs as l,ssrRenderSlot as u,ssrRenderTeleport as v,ssrRenderStyle as m}from"@vue/server-renderer";import{s as f}from"./style-inject.es.js";const w=s.with(class DropdownProps{constructor(){this.debugId=d({type:String,default:""}),this.position=d({type:String,default:""}),this.hoverOverTimeout=d({type:Number,default:30}),this.hoverOutTimeout=d({type:Number,default:200}),this.modelValue=d({type:Boolean,default:!1}),this.disabled=d({type:Boolean}),this.attachElement=d({type:String,default:"body"}),this.disableAttachment=d({type:Boolean}),this.keepAnchorWidth=d({type:Boolean}),this.anchorSelector=d({type:String,default:""}),this.closeOnContentClick=d({type:Boolean,default:!0}),this.closeOnClickOutside=d({type:Boolean,default:!0}),this.closeOnAnchorClick=d({type:Boolean,default:!0}),this.isContentHoverable=d({type:Boolean,default:!0}),this.offset=d({type:[Array,Number],default:()=>[]}),this.trigger=d({type:String,default:"click",validator:e=>["click","hover","none"].includes(e)}),this.stateful=d({type:Boolean,default:!0})}});let C=class VaDropdown extends(i(c,w)){constructor(){super(...arguments),this.popperInstance=null,this.anchorWidth=0}get anchorWidthStyles(){return{width:this.anchorWidth+"px",maxWidth:this.anchorWidth+"px"}}get classComputed(){return{"va-dropdown--disabled":this.$props.disabled}}get showContent(){return this.valueComputed}handlePopperInstance(){this.popperInstance&&this.removePopper(),this.showContent&&(this.updateAnchorWidth(),t((()=>{this.initPopper()})))}handleClick(e,t){this.$emit(e),t&&this.hide()}onDropdownContentClick(){this.handleClick("dropdown-content-click",this.closeOnContentClick)}onClickOutside(){this.handleClick("click-outside",this.closeOnClickOutside)}onAnchorClick(){if(!this.$props.disabled){if("click"===this.$props.trigger){if(this.valueComputed)return void this.handleClick("anchor-click",this.closeOnAnchorClick);this.valueComputed=!0}this.$emit("anchor-click")}}onMouseOver(){this.$props.disabled||"hover"!==this.$props.trigger||(this.valueComputed||this.hoverOverDebounceLoader.run(),this.hoverOutDebounceLoader.reset())}onMouseOut(){"hover"===this.$props.trigger&&(this.isContentHoverable?this.hoverOutDebounceLoader.run():this.valueComputed=!1,this.hoverOverDebounceLoader.reset())}registerClickOutsideListener(){document.addEventListener("click",(e=>this.handleDocumentClick(e)),!1)}unregisterClickOutsideListener(){document.removeEventListener("click",(e=>this.handleDocumentClick(e)),!1)}handleDocumentClick(e){let t=e.target;const o=[];for(;t;)o.push(t),t=t.parentNode;o.includes(this.$refs.anchor)||o.includes(this.$refs.contentWrapper)||this.showContent&&this.onClickOutside()}updateAnchorWidth(){this.keepAnchorWidth&&(this.anchorWidth=this.$refs.anchor.offsetWidth),this.popperInstance&&this.popperInstance.forceUpdate()}hide(){this.valueComputed=!1}initPopper(){const e={placement:this.position||"bottom",modifiers:[],onFirstUpdate:()=>{this.valueComputed=!0}};this.offset&&e.modifiers.push({name:"offset",options:{offset:Array.isArray(this.offset)?this.offset:[this.offset]}});const t=this.$props.anchorSelector&&this.$refs.anchor.querySelector(this.$props.anchorSelector)||this.$refs.anchor;this.popperInstance=p(t,this.$refs.contentWrapper,e)}removePopper(){this.valueComputed=!1,this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null)}created(){o((()=>this.showContent),(()=>{this.handlePopperInstance()})),this.hoverOverDebounceLoader=new h((async()=>{this.valueComputed=!0}),this.hoverOverTimeout),this.hoverOutDebounceLoader=new h((async()=>{this.valueComputed=!1}),this.hoverOutTimeout),this.$isServer||this.registerClickOutsideListener()}mounted(){this.handlePopperInstance()}beforeUnmount(){this.unregisterClickOutsideListener(),this.removePopper()}};C=e([a({name:"VaDropdown",emits:["update:modelValue","anchor-click","click-outside","dropdown-content-click"]})],C);var k=C;f(":root{--va-dropdown-line-height:1;--va-dropdown-content-wrapper-z-index:var(--va-z-index-teleport-overlay)}.va-dropdown{font-family:var(--va-font-family);line-height:var(--va-dropdown-line-height)}.va-dropdown--disabled{cursor:default;opacity:.4;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.va-dropdown__content-wrapper{z-index:var(--va-dropdown-content-wrapper-z-index)}"),k.ssrRender=function ssrRender$1(e,t,o,r,s,i,a,d){t(`<div${l(n({class:["va-dropdown",e.classComputed]},r))}><div class="va-dropdown__anchor">`),u(e.$slots,"anchor",{},null,t,o),t("</div>"),e.showContent?v(t,(t=>{t(`<div class="va-dropdown__content-wrapper"><div style="${m(e.$props.keepAnchorWidth?e.anchorWidthStyles:"")}">`),u(e.$slots,"default",{},null,t,o),t("</div></div>")}),e.attachElement,e.disableAttachment,o):t("\x3c!----\x3e"),t("</div>")},k.__file="src/components/va-dropdown/VaDropdown.vue";var y=r({name:"VaDropdownContent",props:{noPadding:{type:Boolean,default:!1}}});f(":root{--va-dropdown-content-background:#fff;--va-dropdown-content-padding:0.5rem;--va-dropdown-content-box-shadow:var(--va-box-shadow);--va-dropdown-content-border-radius:4px}.va-dropdown__content{background:var(--va-dropdown-content-background);border-radius:var(--va-dropdown-content-border-radius);box-shadow:var(--va-dropdown-content-box-shadow);font-family:var(--va-font-family);padding:var(--va-dropdown-content-padding)}"),y.ssrRender=function ssrRender(e,t,o,r,s,i,a,d){t(`<div${l(n({class:"va-dropdown__content",style:e.noPadding&&{padding:0}},r))}>`),u(e.$slots,"default",{},null,t,o),t("</div>")},y.__file="src/components/va-dropdown/VaDropdownContent/VaDropdownContent.vue";export{k as a,y as s};
//# sourceMappingURL=VaDropdownContent.js.map
