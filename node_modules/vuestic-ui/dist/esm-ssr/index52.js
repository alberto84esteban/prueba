import{w as e}from"./withConfigTransport.js";import{a as l}from"./debounce.js";import{onMounted as i,onBeforeUnmount as r,defineComponent as n,ref as t,computed as s,watch as o,resolveComponent as a,createVNode as v,resolveDynamicComponent as c,mergeProps as u,withCtx as d,renderSlot as f,createCommentVNode as p}from"vue";import{s as m}from"./utils.js";import{u as _}from"./useColor.js";import{VaProgressCircle as g}from"./index39.js";import{ssrRenderVNode as h,ssrRenderSlot as y,ssrRenderClass as b,ssrRenderComponent as j}from"@vue/server-renderer";import{s as x}from"./style-inject.es.js";import"./VaConfig.js";import"./toNumber.js";import"./color-config.js";import"colortranslator";import"./clamp.js";import"./useSize.js";var S=n({name:"VaInfiniteScroll",components:{VaProgressCircle:g},props:{load:{type:Function,required:!0},offset:{type:Number,default:500},reverse:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},scrollTarget:{type:[Element,String],default:null},debounce:{type:Number,default:100},tag:{type:String,default:"div"}},emits:["onload","onerror"],setup(e,{emit:n}){const a=t(),v=t(),c=t(!1),u=t(!1),d=t(!1),f=t(),p=t(0),g=t(0),h=s((()=>{var l;let i;return i="string"==typeof e.scrollTarget?document.querySelector(e.scrollTarget):e.scrollTarget||(null===(l=a.value)||void 0===l?void 0:l.parentElement),i||document.body})),{addScrollListener:y,removeScrollListener:b}=((e,l,n)=>{const addScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.addEventListener("scroll",n.value,{passive:!0})},removeScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.removeEventListener("scroll",n.value)};return i((()=>{l.value&&(l.value.style.overflowY="scroll",e.reverse&&(l.value.scrollTop=l.value.scrollHeight),addScrollListener())})),r(removeScrollListener),{addScrollListener:addScrollListener,removeScrollListener:removeScrollListener}})(e,h,f),{computeColor:j}=_(e),x=s((()=>u.value?j("danger"):j("primary"))),S=s((()=>{var e;return(null===(e=v.value)||void 0===e?void 0:e.offsetHeight)||0})),$=s((()=>e.offset+S.value)),stop=()=>{e.disabled||(c.value=!1,b())},resume=()=>{e.disabled||y()},onLoad=()=>{const{scrollTop:l,scrollHeight:i,clientHeight:r}=h.value;p.value=i-l;const n=l-g.value;if(g.value=l,e.disabled||u.value||c.value)return;if(d.value)return void(d.value=!1);if(e.reverse&&n>0||!e.reverse&&n<0)return;(e.reverse?l:i-l-r)>$.value||(c.value=!0,e.load().then(finishLoading).catch(onError))},forceSetScrollTopToTarget=e=>{d.value=!0,h.value.scrollTop=e},updateTargetElementScrollTop=()=>{const{scrollTop:l,scrollHeight:i,clientHeight:r}=h.value;if(e.reverse){const e=i-l<p.value,r=l>=S.value;if(e&&r)return;i-p.value>S.value?forceSetScrollTopToTarget(i-p.value):forceSetScrollTopToTarget(S.value)}if(!e.reverse){!(i-l-r>=S.value)&&forceSetScrollTopToTarget(i-r-S.value)}},finishLoading=()=>{updateTargetElementScrollTop(),c.value=!1,n("onload")},stopErrorDisplay=()=>{updateTargetElementScrollTop(),d.value=!1,u.value=!1,c.value=!1,n("onerror")},onError=()=>{stop(),u.value=!0,m(1200).then(stopErrorDisplay).then(resume)};return o((()=>e.debounce),(e=>{f.value=l(onLoad,e)}),{immediate:!0}),o((()=>e.disabled),(e=>{e?stop():resume()})),{element:a,spinnerSlotContainer:v,spinnerColor:x,fetching:c}}});x(":root{--va-infinite-scroll-display:flex;--va-infinite-scroll-flex-direction:column;--va-infinite-scroll-spinner-default-width:100%;--va-infinite-scroll-spinner-default-min-height:70px;--va-infinite-scroll-reversed-flex-direction:column-reverse}.va-infinite-scroll{display:var(--va-infinite-scroll-display);flex-direction:var(--va-infinite-scroll-flex-direction);font-family:var(--va-font-family)}.va-infinite-scroll--reversed{flex-direction:var(--va-infinite-scroll-reversed-flex-direction)}.va-infinite-scroll__spinner,.va-infinite-scroll__spinner__default{align-items:center;display:flex;justify-content:center}.va-infinite-scroll__spinner__default{min-height:var(--va-infinite-scroll-spinner-default-min-height);width:var(--va-infinite-scroll-spinner-default-width)}.va-infinite-scroll__spinner--invisible{visibility:hidden!important}"),S.ssrRender=function ssrRender(e,l,i,r,n,t,s,o){const m=a("va-progress-circle");h(l,v(c(e.$props.tag),u({class:["va-infinite-scroll",{"va-infinite-scroll--reversed":e.$props.reverse}],ref:"element"},r),{default:d(((l,i,r,n)=>{if(!i)return[f(e.$slots,"default"),v("div",{class:["va-infinite-scroll__spinner",{"va-infinite-scroll__spinner--invisible":!e.fetching}],ref:"spinnerSlotContainer"},[e.$props.disabled?p("v-if",!0):f(e.$slots,"loading",{key:0},(()=>[v("div",{class:"va-infinite-scroll__spinner__default"},[v(m,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,8,["thickness","color"])])]))],2)];y(e.$slots,"default",{},null,i,r,n),i(`<div class="${b([{"va-infinite-scroll__spinner--invisible":!e.fetching},"va-infinite-scroll__spinner"])}"${n}>`),e.$props.disabled?i("\x3c!----\x3e"):y(e.$slots,"loading",{},(()=>{i(`<div class="va-infinite-scroll__spinner__default"${n}>`),i(j(m,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,r,n)),i("</div>")}),i,r,n),i("</div>")})),_:3}),i)},S.__file="src/components/va-infinite-scroll/VaInfiniteScroll.vue";var $=e(S);export{$ as default};
//# sourceMappingURL=index52.js.map
