import{__decorate as e}from"tslib";import{nextTick as t,watch as o,openBlock as n,createElementBlock as r,normalizeClass as s,createElementVNode as i,withKeys as a,withModifiers as d,renderSlot as p,createBlock as h,Teleport as c,normalizeStyle as l,createCommentVNode as u,defineComponent as v}from"vue";import{V as f,m,O as C,p as w}from"./vue-class-component.esm-bundler.js";import{DebounceLoader as k}from"asva-executors";import{createPopper as b}from"@popperjs/core";import{S as y}from"./StatefulMixin.js";import{s as g}from"./style-inject.es.js";const O=f.with(class DropdownProps{constructor(){this.debugId=w({type:String,default:""}),this.position=w({type:String,default:""}),this.hoverOverTimeout=w({type:Number,default:30}),this.hoverOutTimeout=w({type:Number,default:200}),this.modelValue=w({type:Boolean,default:!1}),this.disabled=w({type:Boolean}),this.attachElement=w({type:String,default:"body"}),this.disableAttachment=w({type:Boolean}),this.keepAnchorWidth=w({type:Boolean}),this.anchorSelector=w({type:String,default:""}),this.closeOnContentClick=w({type:Boolean,default:!0}),this.closeOnClickOutside=w({type:Boolean,default:!0}),this.closeOnAnchorClick=w({type:Boolean,default:!0}),this.isContentHoverable=w({type:Boolean,default:!0}),this.offset=w({type:[Array,Number],default:()=>[]}),this.trigger=w({type:String,default:"click",validator:e=>["click","hover","none"].includes(e)}),this.stateful=w({type:Boolean,default:!0})}});let $=class VaDropdown extends(m(y,O)){constructor(){super(...arguments),this.popperInstance=null,this.anchorWidth=0}get anchorWidthStyles(){return{width:this.anchorWidth+"px",maxWidth:this.anchorWidth+"px"}}get classComputed(){return{"va-dropdown--disabled":this.$props.disabled}}get showContent(){return this.valueComputed}handlePopperInstance(){this.popperInstance&&this.removePopper(),this.showContent&&(this.updateAnchorWidth(),t((()=>{this.initPopper()})))}handleClick(e,t){this.$emit(e),t&&this.hide()}onDropdownContentClick(){this.handleClick("dropdown-content-click",this.closeOnContentClick)}onClickOutside(){this.handleClick("click-outside",this.closeOnClickOutside)}onAnchorClick(){if(!this.$props.disabled){if("click"===this.$props.trigger){if(this.valueComputed)return void this.handleClick("anchor-click",this.closeOnAnchorClick);this.valueComputed=!0}this.$emit("anchor-click")}}onMouseOver(){this.$props.disabled||"hover"!==this.$props.trigger||(this.valueComputed||this.hoverOverDebounceLoader.run(),this.hoverOutDebounceLoader.reset())}onMouseOut(){"hover"===this.$props.trigger&&(this.isContentHoverable?this.hoverOutDebounceLoader.run():this.valueComputed=!1,this.hoverOverDebounceLoader.reset())}registerClickOutsideListener(){document.addEventListener("click",(e=>this.handleDocumentClick(e)),!1)}unregisterClickOutsideListener(){document.removeEventListener("click",(e=>this.handleDocumentClick(e)),!1)}handleDocumentClick(e){let t=e.target;const o=[];for(;t;)o.push(t),t=t.parentNode;o.includes(this.$refs.anchor)||o.includes(this.$refs.contentWrapper)||this.showContent&&this.onClickOutside()}updateAnchorWidth(){this.keepAnchorWidth&&(this.anchorWidth=this.$refs.anchor.offsetWidth),this.popperInstance&&this.popperInstance.forceUpdate()}hide(){this.valueComputed=!1}initPopper(){const e={placement:this.position||"bottom",modifiers:[],onFirstUpdate:()=>{this.valueComputed=!0}};this.offset&&e.modifiers.push({name:"offset",options:{offset:Array.isArray(this.offset)?this.offset:[this.offset]}});const t=this.$props.anchorSelector&&this.$refs.anchor.querySelector(this.$props.anchorSelector)||this.$refs.anchor;this.popperInstance=b(t,this.$refs.contentWrapper,e)}removePopper(){this.valueComputed=!1,this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null)}created(){o((()=>this.showContent),(()=>{this.handlePopperInstance()})),this.hoverOverDebounceLoader=new k((async()=>{this.valueComputed=!0}),this.hoverOverTimeout),this.hoverOutDebounceLoader=new k((async()=>{this.valueComputed=!1}),this.hoverOutTimeout),this.$isServer||this.registerClickOutsideListener()}mounted(){this.handlePopperInstance()}beforeUnmount(){this.unregisterClickOutsideListener(),this.removePopper()}};$=e([C({name:"VaDropdown",emits:["update:modelValue","anchor-click","click-outside","dropdown-content-click"]})],$);var D=$;g(":root{--va-dropdown-line-height:1;--va-dropdown-content-wrapper-z-index:var(--va-z-index-teleport-overlay)}.va-dropdown{font-family:var(--va-font-family);line-height:var(--va-dropdown-line-height)}.va-dropdown--disabled{cursor:default;opacity:.4;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.va-dropdown__content-wrapper{z-index:var(--va-dropdown-content-wrapper-z-index)}"),D.render=function render$1(e,t,o,v,f,m){return n(),r("div",{class:s(["va-dropdown",e.classComputed])},[i("div",{class:"va-dropdown__anchor",onMouseover:t[0]||(t[0]=t=>e.onMouseOver()),onMouseout:t[1]||(t[1]=t=>e.onMouseOut()),onClick:t[2]||(t[2]=t=>e.onAnchorClick()),onKeyup:t[3]||(t[3]=a(d((t=>e.onAnchorClick()),["stop","prevent"]),["enter"])),ref:"anchor"},[p(e.$slots,"anchor")],544),e.showContent?(n(),h(c,{key:0,to:e.attachElement,disabled:e.disableAttachment},[i("div",{class:"va-dropdown__content-wrapper",onMouseover:t[4]||(t[4]=t=>e.$props.isContentHoverable&&e.onMouseOver()),onMouseout:t[5]||(t[5]=t=>e.onMouseOut()),onClick:t[6]||(t[6]=d((t=>e.onDropdownContentClick()),["stop"])),ref:"contentWrapper"},[i("div",{style:l(e.$props.keepAnchorWidth?e.anchorWidthStyles:"")},[p(e.$slots,"default")],4)],544)],8,["to","disabled"])):u("v-if",!0)],2)},D.__file="src/components/va-dropdown/VaDropdown.vue";var x=v({name:"VaDropdownContent",props:{noPadding:{type:Boolean,default:!1}}});g(":root{--va-dropdown-content-background:#fff;--va-dropdown-content-padding:0.5rem;--va-dropdown-content-box-shadow:var(--va-box-shadow);--va-dropdown-content-border-radius:4px}.va-dropdown__content{background:var(--va-dropdown-content-background);border-radius:var(--va-dropdown-content-border-radius);box-shadow:var(--va-dropdown-content-box-shadow);font-family:var(--va-font-family);padding:var(--va-dropdown-content-padding)}"),x.render=function render(e,t,o,s,i,a){return n(),r("div",{class:"va-dropdown__content",style:l(e.noPadding&&{padding:0})},[p(e.$slots,"default")],4)},x.__file="src/components/va-dropdown/VaDropdownContent/VaDropdownContent.vue";export{D as a,x as s};
//# sourceMappingURL=VaDropdownContent.js.map
