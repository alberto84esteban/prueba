import{w as e}from"./withConfigTransport.js";import{a as l}from"./debounce.js";import{onMounted as i,onBeforeUnmount as r,defineComponent as n,ref as t,computed as o,watch as s,resolveComponent as a,openBlock as v,createBlock as c,resolveDynamicComponent as u,normalizeClass as f,withCtx as d,renderSlot as p,createElementVNode as m,createVNode as g,createCommentVNode as h}from"vue";import{s as _}from"./utils.js";import{u as y}from"./useColor.js";import{VaProgressCircle as b}from"./index39.js";import{s as j}from"./style-inject.es.js";import"./VaConfig.js";import"./toNumber.js";import"./color-config.js";import"colortranslator";import"./clamp.js";import"./useSize.js";var S=n({name:"VaInfiniteScroll",components:{VaProgressCircle:b},props:{load:{type:Function,required:!0},offset:{type:Number,default:500},reverse:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},scrollTarget:{type:[Element,String],default:null},debounce:{type:Number,default:100},tag:{type:String,default:"div"}},emits:["onload","onerror"],setup(e,{emit:n}){const a=t(),v=t(),c=t(!1),u=t(!1),f=t(!1),d=t(),p=t(0),m=t(0),g=o((()=>{var l;let i;return i="string"==typeof e.scrollTarget?document.querySelector(e.scrollTarget):e.scrollTarget||(null===(l=a.value)||void 0===l?void 0:l.parentElement),i||document.body})),{addScrollListener:h,removeScrollListener:b}=((e,l,n)=>{const addScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.addEventListener("scroll",n.value,{passive:!0})},removeScrollListener=()=>{var e;null===(e=l.value)||void 0===e||e.removeEventListener("scroll",n.value)};return i((()=>{l.value&&(l.value.style.overflowY="scroll",e.reverse&&(l.value.scrollTop=l.value.scrollHeight),addScrollListener())})),r(removeScrollListener),{addScrollListener:addScrollListener,removeScrollListener:removeScrollListener}})(e,g,d),{computeColor:j}=y(e),S=o((()=>u.value?j("danger"):j("primary"))),x=o((()=>{var e;return(null===(e=v.value)||void 0===e?void 0:e.offsetHeight)||0})),C=o((()=>e.offset+x.value)),stop=()=>{e.disabled||(c.value=!1,b())},resume=()=>{e.disabled||h()},onLoad=()=>{const{scrollTop:l,scrollHeight:i,clientHeight:r}=g.value;p.value=i-l;const n=l-m.value;if(m.value=l,e.disabled||u.value||c.value)return;if(f.value)return void(f.value=!1);if(e.reverse&&n>0||!e.reverse&&n<0)return;(e.reverse?l:i-l-r)>C.value||(c.value=!0,e.load().then(finishLoading).catch(onError))},forceSetScrollTopToTarget=e=>{f.value=!0,g.value.scrollTop=e},updateTargetElementScrollTop=()=>{const{scrollTop:l,scrollHeight:i,clientHeight:r}=g.value;if(e.reverse){const e=i-l<p.value,r=l>=x.value;if(e&&r)return;i-p.value>x.value?forceSetScrollTopToTarget(i-p.value):forceSetScrollTopToTarget(x.value)}if(!e.reverse){!(i-l-r>=x.value)&&forceSetScrollTopToTarget(i-r-x.value)}},finishLoading=()=>{updateTargetElementScrollTop(),c.value=!1,n("onload")},stopErrorDisplay=()=>{updateTargetElementScrollTop(),f.value=!1,u.value=!1,c.value=!1,n("onerror")},onError=()=>{stop(),u.value=!0,_(1200).then(stopErrorDisplay).then(resume)};return s((()=>e.debounce),(e=>{d.value=l(onLoad,e)}),{immediate:!0}),s((()=>e.disabled),(e=>{e?stop():resume()})),{element:a,spinnerSlotContainer:v,spinnerColor:S,fetching:c}}});const x={class:"va-infinite-scroll__spinner__default"};j(":root{--va-infinite-scroll-display:flex;--va-infinite-scroll-flex-direction:column;--va-infinite-scroll-spinner-default-width:100%;--va-infinite-scroll-spinner-default-min-height:70px;--va-infinite-scroll-reversed-flex-direction:column-reverse}.va-infinite-scroll{display:var(--va-infinite-scroll-display);flex-direction:var(--va-infinite-scroll-flex-direction);font-family:var(--va-font-family)}.va-infinite-scroll--reversed{flex-direction:var(--va-infinite-scroll-reversed-flex-direction)}.va-infinite-scroll__spinner,.va-infinite-scroll__spinner__default{align-items:center;display:flex;justify-content:center}.va-infinite-scroll__spinner__default{min-height:var(--va-infinite-scroll-spinner-default-min-height);width:var(--va-infinite-scroll-spinner-default-width)}.va-infinite-scroll__spinner--invisible{visibility:hidden!important}"),S.render=function render(e,l,i,r,n,t){const o=a("va-progress-circle");return v(),c(u(e.$props.tag),{class:f(["va-infinite-scroll",{"va-infinite-scroll--reversed":e.$props.reverse}]),ref:"element"},{default:d((()=>[p(e.$slots,"default"),m("div",{class:f(["va-infinite-scroll__spinner",{"va-infinite-scroll__spinner--invisible":!e.fetching}]),ref:"spinnerSlotContainer"},[e.$props.disabled?h("v-if",!0):p(e.$slots,"loading",{key:0},(()=>[m("div",x,[g(o,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,8,["thickness","color"])])]))],2)])),_:3},8,["class"])},S.__file="src/components/va-infinite-scroll/VaInfiniteScroll.vue";var C=e(S);export{C as default};
//# sourceMappingURL=index52.js.map
