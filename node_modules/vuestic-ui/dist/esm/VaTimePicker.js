import{toRefs as e,ref as t,watch as i,computed as a,defineComponent as r,onMounted as l,nextTick as o,openBlock as c,createElementBlock as n,withKeys as v,withModifiers as u,Fragment as s,renderList as m,normalizeClass as p,renderSlot as d,normalizeProps as k,guardReactiveProps as h,createTextVNode as f,toDisplayString as g,createElementVNode as b,resolveComponent as y,createBlock as x}from"vue";import{u as I}from"./useSyncProp.js";import{a as w,u as C}from"./useFocus.js";import{s as F}from"./style-inject.es.js";import{s as P,u as N}from"./cStatefulMixin.js";import{u as A,a as M}from"./useForm.js";const safeModelValue=e=>e.value?e.value:new Date((new Date).setHours(0,0,0,0)),createNumbersArray=e=>Array.from(Array(e).keys()),from24to12=e=>(0===e?12:e)-12*Number(e>12),createHoursColumn=(e,t,i)=>{const r=a((()=>e.ampm?12:24)),l=a((()=>{let t=createNumbersArray(r.value);return e.hoursFilter&&(t=t.filter((t=>e.hoursFilter(e.ampm?t+12*Number(i.value):t)))),t.map((t=>e.ampm?from24to12(t):t))})),o=a({get:()=>{if(!t.value)return-1;if(e.ampm){const e=from24to12(t.value.getHours()-12*Number(i.value));return l.value.findIndex((t=>t===e))}const a=t.value.getHours();return l.value.findIndex((e=>e===a))},set:a=>{if(e.readonly)return;const r=e.ampm?((e,t=!1)=>(12===e?0:e)+12*Number(t))(l.value[a],i.value):l.value[a];t.value=new Date(safeModelValue(t).setHours(r))}});return a((()=>({items:l.value,activeItem:o})))},useTimePicker=(r,l)=>{const{view:o}=e(r),c=t(!1);i(l,(()=>{c.value=safeModelValue(l).getHours()>=12}),{immediate:!0});const n=createHoursColumn(r,l,c),v=((e,t)=>{const i=a((()=>{const t=createNumbersArray(60);return e.minutesFilter?t.filter(e.minutesFilter):t})),r=a({get:()=>{if(!t.value)return-1;const e=t.value.getMinutes();return i.value.findIndex((t=>t===e))},set:a=>{if(e.readonly)return;const r=i.value[a];t.value=new Date(safeModelValue(t).setMinutes(r))}});return a((()=>({items:i.value,activeItem:r})))})(r,l),u=((e,t)=>{const i=a((()=>{const t=createNumbersArray(60);return e.secondsFilter?t.filter(e.secondsFilter):t})),r=a({get:()=>{if(!t.value)return-1;const e=t.value.getSeconds();return i.value.findIndex((t=>t===e))},set:a=>{if(e.readonly)return;const r=i.value[a];t.value=new Date(safeModelValue(t).setSeconds(r))}});return a((()=>({items:i.value,activeItem:r})))})(r,l),s=((e,t,i)=>a((()=>({items:["AM","PM"],activeItem:a({get:()=>t.value?Number(i.value):-1,set:a=>{i.value=Boolean(a);const r=safeModelValue(t).getHours();let l=i.value?r+12:r;i.value&&r<=12&&(l=r+12),!i.value&&r>=12&&(l=r-12);const o=!e.hoursFilter||e.hoursFilter(l);e.periodUpdatesModelValue&&o&&(t.value=new Date(safeModelValue(t).setHours(l)))}})}))))(r,l,c);return{columns:a((()=>{const e=[];return"hours"===o.value?e.push(n.value):"minutes"===o.value?e.push(n.value,v.value):"seconds"===o.value&&e.push(n.value,v.value,u.value),r.ampm&&!r.hidePeriodSwitch&&e.push(s.value),e})),isPM:c}};var T=r({name:"VaTimePickerColumn",props:{items:{type:Array,default:()=>[]},activeItemIndex:{type:Number,default:0}},emits:["item-selected","update:activeItemIndex",...w],setup(e,{emit:a}){const r=t();C(r,a);const[c]=I("activeItemIndex",e,a);i(c,(e=>{scrollTo(e)})),l((()=>scrollTo(c.value,!1)));const scrollTo=(e,t=!0)=>{o((()=>{var i,a;const l=r.value.children[e];l?null===(a=r.value)||void 0===a||a.scrollTo({behavior:t?"smooth":"auto",top:l.offsetTop-l.parentElement.offsetTop}):null===(i=r.value)||void 0===i||i.scrollTo({behavior:t?"smooth":"auto",top:0})}))};return{rootElement:r,makeActiveNext:t=>{c.value=(c.value+(t||1))%e.items.length,o((()=>scrollTo(c.value)))},makeActivePrev:t=>{c.value=(c.value-(t||1)+e.items.length)%e.items.length,o((()=>scrollTo(c.value)))},makeActiveByIndex:e=>{c.value=e,o((()=>scrollTo(c.value)))},onCellClick:e=>{c.value=e},formatCell:e=>Number.isInteger(e)?e<10?`0${e}`:`${e}`:e}},methods:{focus(){var e;null===(e=this.rootElement)||void 0===e||e.focus()},blur(){var e;null===(e=this.rootElement)||void 0===e||e.blur()}}});const V=b("div",{class:"va-time-picker-cell va-time-picker-cell--fake"},null,-1),j=["onClick"],D=b("div",{class:"va-time-picker-cell va-time-picker-cell--fake"},null,-1);F('.va-time-picker-column{--va-time-picker-column-border-right:1px solid var(--va-divider);--va-time-picker-cell-height:30px;--va-time-picker-cell-width:40px;--va-time-picker-cell-cursor:pointer;--va-time-picker-cell-active-background:var(--va-primary);--va-time-picker-cell-active-color:var(--va-primary);--va-time-picker-cell-background-color-hover:var(--va-background-color-hover);--va-time-picker-cell-active-background-opacity:0;--va-time-picker-cell-active-background-opacity-hover:0.1;-ms-overflow-style:none;border-right:var(--va-time-picker-column-border-right);height:100%;overflow-y:scroll;scrollbar-width:none}.va-time-picker-column::-webkit-scrollbar{display:none}.va-time-picker-column:last-child{border-right:0}.va-time-picker-column .va-time-picker-cell{cursor:var(--va-time-picker-cell-cursor);height:var(--va-time-picker-cell-height);line-height:var(--va-time-picker-cell-height);text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:var(--va-time-picker-cell-width)}.va-time-picker-column .va-time-picker-cell--active{color:var(--va-time-picker-cell-active-color);position:relative;z-index:0}.va-time-picker-column .va-time-picker-cell--active:before{background:var(--va-time-picker-cell-active-background);content:"";height:100%;left:0;opacity:var(--va-time-picker-cell-active-background-opacity);position:absolute;right:0;width:100%;z-index:-1}.va-time-picker-column .va-time-picker-cell--fake{visibility:hidden}.va-time-picker-column .va-time-picker-cell--fake:last-child{height:calc(100% - var(--va-time-picker-cell-height)*2)}.va-time-picker-column .va-time-picker-cell:hover{background:var(--va-time-picker-cell-background-color-hover)}.va-time-picker-column:focus .va-time-picker-cell--active:before{opacity:var(--va-time-picker-cell-active-background-opacity-hover)}'),T.render=function render$1(e,t,i,a,r,l){return c(),n("div",{tabindex:"0",class:"va-time-picker-column",onKeydown:[t[0]||(t[0]=v(u((t=>e.makeActiveNext()),["stop","prevent"]),["down"])),t[1]||(t[1]=v(u((t=>e.makeActiveNext(5)),["stop","prevent"]),["space"])),t[2]||(t[2]=v(u((t=>e.makeActivePrev()),["stop","prevent"]),["up"]))],ref:"rootElement"},[V,(c(!0),n(s,null,m(e.items,((t,i)=>(c(),n("div",{key:t,class:p({"va-time-picker-cell":!0,"va-time-picker-cell--active":i===e.$props.activeItemIndex}),onClick:t=>e.onCellClick(i)},[d(e.$slots,"cell",k(h({item:t,index:i,activeItemIndex:e.activeItemIndex,items:e.items,formattedItem:e.formatCell(t)})),(()=>[f(g(e.formatCell(t)),1)]))],10,j)))),128)),D],544)},T.__file="src/components/va-time-picker/components/VaTimePickerColumn.vue";var H=r({name:"VaTimePicker",components:{VaTimePickerColumn:T},props:{...P.props,...A,modelValue:{type:Date,required:!1},ampm:{type:Boolean,default:!1},hidePeriodSwitch:{type:Boolean,default:!1},periodUpdatesModelValue:{type:Boolean,default:!0},view:{type:String,default:"minutes"},hoursFilter:{type:Function},minutesFilter:{type:Function},secondsFilter:{type:Function}},emits:[...P.emits],setup(e,{emit:i}){const{valueComputed:a}=N(e,i),{columns:r,isPM:o}=useTimePicker(e,a),c=t([]),n=t(),focus=(e=0)=>{var t;null===(t=c.value[e])||void 0===t||t.focus()},{createComputedClass:v}=M(e),u=v("va-time-picker");return l((()=>{focus()})),{columns:r,computedClass:u,isPM:o,pickers:c,focusNext:()=>{const e=((null==n?void 0:n.value)||0)+1;n.value=e%r.value.length,focus(n.value)},focusPrev:()=>{const e=((null==n?void 0:n.value)||0)-1+r.value.length;n.value=e%r.value.length,focus(n.value)},activeColumnIndex:n}},methods:{focus(e=0){var t;null===(t=this.pickers[e])||void 0===t||t.focus()},blur(e){var t;e?null===(t=this.pickers[e])||void 0===t||t.blur():this.pickers.value.forEach((e=>null==e?void 0:e.blur()))}}});F('.va-time-picker{--va-time-picker-display:inline-flex;--va-time-picker-height:200px;--va-time-picker-disabled-opacity:0.4;display:var(--va-time-picker-display);font-family:var(--va-font-family);height:var(--va-time-picker-height);justify-content:center;overflow:hidden}.va-time-picker--readonly{position:relative}.va-time-picker--readonly:after{content:"";height:100%;position:absolute;width:100%;z-index:1}.va-time-picker--disabled{opacity:var(--va-time-picker-disabled-opacity);position:relative}.va-time-picker--disabled:after{content:"";height:100%;position:absolute;width:100%;z-index:1}'),H.render=function render(e,t,i,a,r,l){const o=y("VaTimePickerColumn");return c(),n("div",{class:p(["va-time-picker",e.computedClass])},[(c(!0),n(s,null,m(e.columns,((i,a)=>(c(),x(o,{key:a,ref:t=>e.pickers.push(t),items:i.items,tabindex:e.disabled?-1:0,activeItemIndex:i.activeItem.value,"onUpdate:activeItemIndex":e=>i.activeItem.value=e,onKeydown:[t[0]||(t[0]=v(u((t=>e.focusNext()),["stop","prevent"]),["right"])),t[1]||(t[1]=v(u((t=>e.focusNext()),["exact","stop","prevent"]),["tab"])),t[2]||(t[2]=v(u((t=>e.focusPrev()),["stop","prevent"]),["left"])),t[3]||(t[3]=v(u((t=>e.focusPrev()),["shift","stop","prevent"]),["tab"]))],onFocus:t=>e.activeColumnIndex=a},null,8,["items","tabindex","activeItemIndex","onUpdate:activeItemIndex","onFocus"])))),128))],2)},H.__file="src/components/va-time-picker/VaTimePicker.vue";export{H as s};
//# sourceMappingURL=VaTimePicker.js.map
